<!DOCTYPE html>












  


<html class="theme-next gemini use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
<meta name="theme-color" content="#222">



  
  
  <link rel="stylesheet" href="/lib/needsharebutton/needsharebutton.css">










<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />






















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.4.0" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.4.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.4.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.4.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.4.0" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '6.4.0',
    sidebar: {"position":"left","display":"always","offset":12,"b2t":true,"scrollpercent":true,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="如果是仅仅简单使用MySQL那是很简单的一件事，而且现在有众多图形画界面(MySQL Front、Navicat、DataGrip等)更方便操作MySQL。但是MySQL的内容远不止于此。建议读者尝试用MySQL自带的Client来操作MySQL，也建议把MySQL安装目录的bin目录添加到环境变量，方便在控制台中使用。">
<meta name="keywords" content="MySQL">
<meta property="og:type" content="article">
<meta property="og:title" content="MySQL">
<meta property="og:url" content="/2019/01/12/数据库/MySQL/index.html">
<meta property="og:site_name" content="COKID">
<meta property="og:description" content="如果是仅仅简单使用MySQL那是很简单的一件事，而且现在有众多图形画界面(MySQL Front、Navicat、DataGrip等)更方便操作MySQL。但是MySQL的内容远不止于此。建议读者尝试用MySQL自带的Client来操作MySQL，也建议把MySQL安装目录的bin目录添加到环境变量，方便在控制台中使用。">
<meta property="og:image" content="/2019/01/12/数据库/MySQL/1.jpg">
<meta property="og:image" content="/2019/01/12/数据库/MySQL/MySQL/1.jpg">
<meta property="og:image" content="/2019/01/12/数据库/MySQL/2.jpg">
<meta property="og:image" content="/2019/01/12/数据库/MySQL/MySQL/2.jpg">
<meta property="og:image" content="/2019/01/12/数据库/MySQL/MySQL/3.jpg">
<meta property="og:image" content="/2019/01/12/数据库/MySQL/MySQL/4.jpg">
<meta property="og:updated_time" content="2019-04-28T08:32:06.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="MySQL">
<meta name="twitter:description" content="如果是仅仅简单使用MySQL那是很简单的一件事，而且现在有众多图形画界面(MySQL Front、Navicat、DataGrip等)更方便操作MySQL。但是MySQL的内容远不止于此。建议读者尝试用MySQL自带的Client来操作MySQL，也建议把MySQL安装目录的bin目录添加到环境变量，方便在控制台中使用。">
<meta name="twitter:image" content="/2019/01/12/数据库/MySQL/1.jpg">






  <link rel="canonical" href="/2019/01/12/数据库/MySQL/"/>



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>MySQL | COKID</title>
  









  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

  <script src="https://cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome/css/font-awesome.min.css"/>
  <script src="/live2d-widget/autoload.js"></script>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">COKID</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">请多多阅读文章</p>
      
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">
    <a href="/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-home"></i> <br />首页</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-about">
    <a href="/about/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-user"></i> <br />关于</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">
    <a href="/tags/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />标签</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">
    <a href="/categories/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-th"></i> <br />分类</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">
    <a href="/archives/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />归档</a>
  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />搜索</a>
        </li>
      
    </ul>
  

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="/2019/01/12/数据库/MySQL/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="COKID">
      <meta itemprop="description" content="Enjoy Code&Life">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="COKID">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">MySQL
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-01-12 21:42:02" itemprop="dateCreated datePublished" datetime="2019-01-12T21:42:02+08:00">2019-01-12</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-04-28 16:32:06" itemprop="dateModified" datetime="2019-04-28T16:32:06+08:00">2019-04-28</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/数据库/" itemprop="url" rel="index"><span itemprop="name">数据库</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/01/12/数据库/MySQL/#comments" itemprop="discussionUrl">
                  <span class="post-meta-item-text">评论数：</span> <span class="post-comments-count valine-comment-count" data-xid="/2019/01/12/数据库/MySQL/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2019/01/12/数据库/MySQL/" class="leancloud_visitors" data-flag-title="MySQL">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数：</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>如果是仅仅简单使用MySQL那是很简单的一件事，而且现在有众多图形画界面(MySQL Front、Navicat、DataGrip等)更方便操作MySQL。但是MySQL的内容远不止于此。建议读者尝试用MySQL自带的Client来操作MySQL，也建议把MySQL安装目录的bin目录添加到环境变量，方便在控制台中使用。</p>
<a id="more"></a>
<h1 id="MySQL引擎"><a href="#MySQL引擎" class="headerlink" title="MySQL引擎"></a>MySQL引擎</h1><p>MySQL的存储引擎是插件式的，我们既可以使用MySQL自带的引擎也可以开发属于自己的引擎，简单介绍一下一些内置的引擎。MySQL引擎是基于表的，一个引擎对应一张表。如图我们可以通过图形化界面也可以使用show engines命令显示我们当前的可以使用的引擎。下文中的特性一般基于的是InnoDB引擎</p>
<img src="/2019/01/12/数据库/MySQL/1.jpg" alt="1.jpg" title="">
<p><img src="MySQL\1.jpg" alt="1"></p>
<h2 id="InnoDB引擎"><a href="#InnoDB引擎" class="headerlink" title="InnoDB引擎"></a>InnoDB引擎</h2><p>从5.5.8版本开始InnoDB是MySQL的默认引擎，也是我们重点要介绍的。InnoDB支持事务，行锁，外键，四种隔离级别(下文中有具体介绍)以及插入缓存，二次写，自适应哈希索引，预读等高性能和高可用功能。每张表的存储是按主键顺序存放，如果没有主键，会自动生成一个6字节的ROWID，作为主键。</p>
<h2 id="MyISAM引擎"><a href="#MyISAM引擎" class="headerlink" title="MyISAM引擎"></a>MyISAM引擎</h2><p>不支持事务，使用表锁，支持全文索引，缓冲池只缓存索引文件不缓冲数据文件，MyISAM存储引擎表由MYD(存放数据文件)和MYI(存放索引文件)组成，最大支持256TB单表，4GB索引缓冲区</p>
<h2 id="Memory"><a href="#Memory" class="headerlink" title="Memory"></a>Memory</h2><p>顾名思义，表的数据是存放在内存中的，默认使用哈希索引，一旦数据库重启崩溃数据丢失，适用于临时存储例如查询的中间结果集，因为表在内存中所以速度会很快。但一旦结果集大于其存储容量MySQL会转换成MyISAM引擎表存放到磁盘，又因为MyISAM不缓存数据文件，没有缓存则查询起来会有性能损失。</p>
<h2 id="Archive"><a href="#Archive" class="headerlink" title="Archive"></a>Archive</h2><p>只支持Insert和Select操作，支持索引，使用zlib算法对数据行压缩存储。适用于存储归档数据，例如日志信息。使用行锁实现高并发插入操作但本身不是事务安全的。</p>
<h2 id="Federated"><a href="#Federated" class="headerlink" title="Federated"></a>Federated</h2><p>不存储表，指向远程MySQL数据库服务器上的表。只支持MySQL，不支持异构数据库表。</p>
<h1 id="MySQL文件"><a href="#MySQL文件" class="headerlink" title="MySQL文件"></a>MySQL文件</h1><h2 id="参数文件"><a href="#参数文件" class="headerlink" title="参数文件"></a>参数文件</h2><h3 id="查看"><a href="#查看" class="headerlink" title="查看"></a>查看</h3><p>当MySQL实例启动时，会预先读取一个参数文件，用来初始化某些参数，文件可以在MySQL数据文件夹下的找到名字为my.ini，里面有一些参数我们可以手动修改。也可以查看information_schema库下面的GLOBAL_VARIABLES进行查看相关参数,比如查看InnoDB缓存相关的参数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">select * from</div><div class="line">GLOBAL_VARIABLES</div><div class="line">where VARIABLE_NAME like &apos;innodb_buffer%&apos;\g</div></pre></td></tr></table></figure>
<p>上述语句有点长可以直接执行 </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">show</span> <span class="keyword">variables</span> <span class="keyword">like</span> <span class="string">'innodb_buffer%'</span>\g</div></pre></td></tr></table></figure>
<img src="/2019/01/12/数据库/MySQL/2.jpg" alt="2.jpg" title="">
<p><img src="MySQL\2.jpg" alt="2"></p>
<p>可能有读者执行时会遇到<em>The ‘INFORMATION_SCHEMA.GLOBAL_VARIABLES’ feature is disabled; see the documentation for ‘show_compatibility_56’</em>错误。那么请执行<code>SET GLOBAL show_compatibility_56 = ON;</code>完成后再执行上面的sql语句即可查看。</p>
<p>当然最简单的方法是直接查看my.ini 文件</p>
{% asset_img 3.jpg %}
<p><img src="MySQL\3.jpg" alt="3"></p>
<h3 id="修改"><a href="#修改" class="headerlink" title="修改"></a>修改</h3><p>修改命令如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">SET global|session 参数名=值</div><div class="line"></div><div class="line">SET read_buffer_size=524288</div></pre></td></tr></table></figure>
<p>MySQL参数分为两类：动态参数，静态参数</p>
<p>动态参数可以通过上述命令修改，静态参数在实例生命周期内不能修改。</p>
<h2 id="日志文件"><a href="#日志文件" class="headerlink" title="日志文件"></a>日志文件</h2><p>日志文件分为一般日志，错误日志，慢查询日志，二进制日志</p>
{% asset_img 4.jpg %}
<p><img src="MySQL\4.jpg" alt="4"></p>
<p>日志文件可以在数据文件夹下的Data文件夹下找到，博主只开启了一份慢查询日志，和错误日志，没有开启一般日志，以及二进制日志。</p>
<p><strong>错误日志帮助我们找到一些错误信息</strong></p>
<p><strong>慢查询日志帮助我们优化数据库语句</strong></p>
<p>重点介绍一下</p>
<h3 id="二进制日志"><a href="#二进制日志" class="headerlink" title="二进制日志"></a>二进制日志</h3><p>二进制日志记录了对数据库的所有操作，但是不包括select和show等操作，其他操作即使没有修改数据库例如update也可能写入日志里。二进制日志可以用来，恢复，复制数据库，也可以查看是否有对数据库的攻击。</p>
<p>关于二进制日志的参数</p>
<ul>
<li>max_binlog_size 单个二进制文件最大值</li>
<li>binlog_cache_size 未提交事务二进制日志会写入缓存</li>
<li>sync_binlog 每写缓冲多少次同步到磁盘</li>
<li>binlog-do-db 指定写入日志的数据库</li>
<li>binlog-ignore-db 忽略写入日志的数据库</li>
<li>log-slave-update 如果此台机器是slave机器将会取得Master的二进制日志更新自己日志 </li>
<li>binlog_format 二进制格式</li>
</ul>
<p>对二进制文件的操作：</p>
<ul>
<li><p>查看是否开启</p>
<p><code>show variables like &quot;%log_bin%&quot;</code></p>
</li>
<li><p>与bin-log有关的操作</p>
<p><code>mysql&gt; flush logs；</code> 日志刷新，此时就会多出一个最新的bin-log日志</p>
<p><code>mysql&gt; show master status ;</code> 查看最后一个bin日志</p>
<p><code>mysql&gt; reset master;</code> 清空所有bin-log日志</p>
<p><code>mysql&gt; mysqlbinlog --no-defaults mysql-00001.bin</code>  查看bin-log日志的内容</p>
</li>
<li><p>mysql备份和bin-log日志</p>
<p>备份数据：</p>
<p><code>mysqldump -uroot -pPASSWORD test -l -F &gt;&#39;/tmp/test.sql&#39;</code> -F即flush logs，可以重新生成新的日志文件，包括log-bin日志；-l 为读锁，读锁时所有数据不允许写</p>
<p>恢复数据：</p>
<p><code>mysql -uroot -pPASSWORD test -v -f &lt;/tmp/test.sql</code> -v查看导入的详细信息；-f当遇到错误时skip，继续执行下面的语句。</p>
<p><code>mysql&gt; mysqlbinlog --no-defaults mysql-00001.bin | mysql -uUSERNAME -pPASSWORD databasename</code></p>
<p>用bin-log日志恢复数据库 </p>
</li>
</ul>
<h2 id="套接字文件"><a href="#套接字文件" class="headerlink" title="套接字文件"></a>套接字文件</h2><p>仅限于Unix系统，Unix连接MySQL可以采用Unix域套接字方式，这种方式需要一个套接字文件。</p>
<h2 id="PID文件"><a href="#PID文件" class="headerlink" title="PID文件"></a>PID文件</h2><p>MySQL启动时会将自己的进程ID写入一个文件,在数据文件夹下的Data文件夹下的扩展名为.pid的文件，可由pid_file参数控制</p>
<h2 id="frm文件"><a href="#frm文件" class="headerlink" title="frm文件"></a>frm文件</h2><p>MySQL是插件式的存储引擎的体系结构关系，MySQL数据的存储是根据表进行的，每个表都有对应的文件，因此用.frm来记录表的结构定义</p>
<h2 id="表空间文件（InnoDB）"><a href="#表空间文件（InnoDB）" class="headerlink" title="表空间文件（InnoDB）"></a>表空间文件（InnoDB）</h2><p>InnoDB采用将存储的数据按照表空间进行存放的设计，默认配置下初始大小10M，有个名为ibdata1的文件，就是默认表空间文件。</p>
<h2 id="重做日志文件（InnoDB）"><a href="#重做日志文件（InnoDB）" class="headerlink" title="重做日志文件（InnoDB）"></a>重做日志文件（InnoDB）</h2><p>ib_logfile0和ib_logfile1文件记录了对于InnoDB存储引擎的事务日志。如果数据库由于主机断电导致实例失败，InnoDB会使用重做日志文件恢复到掉电前的时刻。至少有一个重做日志文件组，每个组至少2个文件，每个文件大小一致，参用循环方式写入。 </p>
<h1 id="MySQL索引"><a href="#MySQL索引" class="headerlink" title="MySQL索引"></a>MySQL索引</h1><h2 id="定义："><a href="#定义：" class="headerlink" title="定义："></a>定义：</h2><p><strong>索引（Index）是帮助MySQL高效获取数据的数据结构。</strong></p>
<p>可以理解为“排好序的快速查找的数据结构”。在数据之外，数据库系统还维护着满足特定查找算法的数据结构，这些数据结构以某种方式引用(指向)数据，这样就可以在这些数据 结构上实现高级查找算法。这种数据结构就是索引。</p>
<p> 一般来说索引本身也很大，不可能全部存储在内存中，因此索引往往以索引文件的形式存储在磁盘上</p>
<p><strong>我们平时说的索引，如果没有特别指明，都是指B树(多路搜索树，并不一定+是二叉树)结构组织的索引</strong>，其中，聚集索引，次要索引，复合索引，前缀索引，唯一索引默认都是使用B+树索引，统称索引。当然，除了B+树这种类型的索引之外，还有哈希索引等。</p>
<h2 id="MySQL索引结构（InnoDB）"><a href="#MySQL索引结构（InnoDB）" class="headerlink" title="MySQL索引结构（InnoDB）"></a>MySQL索引结构（InnoDB）</h2><ul>
<li><p>B+树索引</p>
</li>
<li><p>哈希索引</p>
</li>
<li><p>全文索引</p>
</li>
</ul>
<p>InnoDB存储引擎会根据表的使用情况自动生成哈希索引，不能人为干预是否在一张表中生成哈希索引。传统说索引一般指B+树索引（B树详情参见本博客相关文章）。我们需要明确<strong>B+树索引并不是给定指定的键值来找到具体的行，B+树只能找到查找数据行所在的页</strong>。B+树索引在数据库有一个特点是高扇出性，因此在数据库中，B+树的高度一般在2~4层，因此查找某一键值的行记录时最多需要2~4次IO。B+树索引可以分为聚集索引和辅助索引，其内部都是B+树结构，不同点在于叶子节点存放的是否是一整行的信息。</p>
<h3 id="聚集索引"><a href="#聚集索引" class="headerlink" title="聚集索引"></a>聚集索引</h3><p>聚集索引按照每张表的主键构造一棵B+树，叶子节点中存放的为整张表的行记录数据，也将聚集索引的叶子结点称为数据页。每个数据页通过一个双向链表来进行链接。由于实际的数据页只能按照一棵B+树进行排序，因此每张表只能拥有一个聚集索引。多数情况下，查询优化器倾向于采用聚集索引。因为聚集索引能够在B+树索引的叶子节点上直接找到数据。由于定义了数据的逻辑顺序，因此能特别快速地访问针对范围值的查询。</p>
<h3 id="辅助索引"><a href="#辅助索引" class="headerlink" title="辅助索引"></a>辅助索引</h3><p>叶子节点不包含行记录的全部数据。叶子节点除了包含键值之外还包含一个书签，指向相应数据行的聚集索引。每张表上可以有多个辅助索引，通过辅助索引查找数据，会遍历辅助索引并通过叶级别的指针获得指向主键索引的主键，然后通过主键索引来找到一个完整的行记录。</p>
<h2 id="优点："><a href="#优点：" class="headerlink" title="优点："></a>优点：</h2><ul>
<li>提高数据检索的效率，降低数据库的IO成本。</li>
<li>通过索引列对数据进行排序，降低数据排序的成本，降低了CPU的消耗。</li>
</ul>
<h2 id="缺点："><a href="#缺点：" class="headerlink" title="缺点："></a>缺点：</h2><ul>
<li>实际上索引也是一张表，保存了主键与索引字段，并指向实体表的记录，所以索引也是要占空间的</li>
<li>虽然索引大大提高了查询速度却会降低更新表的速度(UPDATE DELETE INSERT)，因为更新表时，MySQL不仅要保存数据，还要保存一下索引文件每次更新添加了索引列的字段，都会调整因为更新所带来的剑指变化后的索引信息。</li>
<li>索引知识提高效率的一个因素，如果MySQL有大量的表，就需要花时间研究建立最优秀的索引，或优化查询语句</li>
</ul>
<h2 id="MySQL索引分类"><a href="#MySQL索引分类" class="headerlink" title="MySQL索引分类"></a>MySQL索引分类</h2><ul>
<li>单值索引：一个索引只包含单个列，一个表可以有多个单列索引</li>
<li>唯一索引：一个索引的值必须唯一，但允许有控制</li>
<li>复合索引：一个索引包含多个列</li>
</ul>
<h2 id="MySQL索引语法"><a href="#MySQL索引语法" class="headerlink" title="MySQL索引语法"></a>MySQL索引语法</h2><ul>
<li><p>创建：<code>CREATE [UNIQUE] INDEX indexName ON mytable(columnname(length))</code></p>
<p><code>ALTER mytable ADD [UNIQUE] INDEX [indexName] ON (columnname(length))</code> </p>
</li>
<li><p>删除：<code>DROP INDEX [indexName] ON mytable</code></p>
</li>
<li><p>查看：<code>SHOW INDEX FROM table_name\G</code></p>
</li>
</ul>
<p>产看结果会显示一些列的信息</p>
<ul>
<li>Table 表名</li>
<li>Non_unique 非唯一的索引</li>
<li>Key_name 索引的名字</li>
<li>Seq_in_index 索引中该列的位置</li>
<li>Column_name 索引列的名称</li>
<li>Collaction 列以什么方式存储在索引中</li>
<li><strong>Cardinality</strong> 索引中唯一值的数目的估计值</li>
<li>Sub_part 是否是列的部分被索引，如果索引整个列该字段为NULL</li>
<li>Packed 关键字如何被压缩</li>
<li>Null 索引的列中是否含有Null值</li>
<li>Index_type 索引的类型，显示BTREE实际是B+树索引</li>
<li>Comment 注释</li>
</ul>
<p>有四种方式来添加数据表的索引：</p>
<ul>
<li><p><strong>ALTER TABLE tbl_name ADD PRIMARY KEY (column_list):</strong></p>
<p>该语句添加一个主键，这意味着索引值必须是唯一的，且不能为NULL。</p>
</li>
<li><p><strong>ALTER TABLE tbl_name ADD UNIQUE index_name (column_list):</strong></p>
<p>这条语句创建索引的值必须是唯一的（除了NULL外，NULL可能会出现多次）。</p>
</li>
<li><p><strong>ALTER TABLE tbl_name ADD INDEX index_name (column_list):</strong></p>
<p>添加普通索引，索引值可出现多次。</p>
</li>
<li><p><strong>ALTER TABLE tbl_name ADD FULLTEXT index_name (column_list):</strong></p>
<p>该语句指定了索引为 FULLTEXT ，用于全文索引。</p>
</li>
</ul>
<h2 id="什么时候建立索引"><a href="#什么时候建立索引" class="headerlink" title="什么时候建立索引"></a>什么时候建立索引</h2><ul>
<li>主键自动建立唯一索引</li>
<li>频繁作为查询条件的字段应该创建索引</li>
<li>查询中与其他表关联的字段，外键关系建立索引</li>
<li>高并发下倾向创建组合索引</li>
<li>查询中排序的字段</li>
<li>查询中统计或者分组字段</li>
</ul>
<p>上文中查询索引的字段中有一个重要的值Cardinality，它显示的是索引中不重复记录数量的预估值。用户可以参考这个值决定是否去建立索引。如果某个字段选取范围很广，几乎没有重复值例如姓名，则比较适合建立索引。Cardinality统计信息更新发生在UPDATE和DELETE阶段但是不能每次操作都统计一次Cardinality，所以内置策略是当表中1/16数据发生变化或者变化次数（stat_modified_counter）超过20亿次时。采样计数采用随机抽取B+树的8个叶子节点，统计数量然后把看看整B+树所有叶子节点可以分为几个8，然后乘以刚才采样的统计数量。</p>
<h2 id="什么时候不要索引"><a href="#什么时候不要索引" class="headerlink" title="什么时候不要索引"></a>什么时候不要索引</h2><ul>
<li>表记录太少</li>
<li>经常增删改的表</li>
<li>数据重复且平均的表字段</li>
</ul>
<h1 id="MySQL事务"><a href="#MySQL事务" class="headerlink" title="MySQL事务"></a>MySQL事务</h1><h2 id="事务的概念"><a href="#事务的概念" class="headerlink" title="事务的概念"></a>事务的概念</h2><p>mysql 的默认引擎innodb支持事务</p>
<p>TCL(Transanction Control Language) 事务控制语言</p>
<p>事务：一个或一组sql语句组成一个执行单元，但这个执行单元要么全部执行，要么全部不执行,如果某条执行失败或者出现错误，将进行回滚。</p>
<p>在关系型数据库中，<strong>事务有4个特性ACID</strong>：A原子性，C一致性，I独立性，D持久性（详见文Redis）</p>
<h2 id="Mysql使用事务"><a href="#Mysql使用事务" class="headerlink" title="Mysql使用事务"></a>Mysql使用事务</h2><p>事物的创建 </p>
<ul>
<li><p>隐式事务：事物没有明显的开启和结束的标记；比如insert、 update、delete语句</p>
</li>
<li><p>显式事务：有明显的开启和结束的标记；前提：必须先设置自动提交的功能为禁用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">show variables like &apos;autocommit&apos; #查看自动提交的状态</div><div class="line">set autocommit=0; #关闭自动提交，只对当前会话有效。每次打开都需要设置一次</div><div class="line">start transaction; #开启事务，可选，因为只要写了上面的语句就认为开启了事务。 </div><div class="line">#编写事务中的sql语句（select insert update delete）</div><div class="line">commit;#提交事务</div><div class="line">rollback;#事务回滚</div></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="事务的并发"><a href="#事务的并发" class="headerlink" title="事务的并发"></a>事务的并发</h2><p>对于同时运行的多个事务, 当这些事务访问数据库中相同的数据时, 如果没有采取必要的隔离机制, 就会导致各种并发问题:</p>
<ul>
<li>脏读: 对于两个事务 T1, T2, T1 读取了已经被 T2 更新但还没有被提交的字段.之后, 若 T2 回滚, T1读取的内容就是临时且无效的.（没提交回滚）</li>
<li>不可重复读: 对于两个事务T1, T2, T1 读取了一个字段, 然后 T2 更新了该字段.之后, T1再次读取同一个字段, 值就不同了.（更新）</li>
<li>幻读: 对于两个事务T1, T2, T1 从一个表中读取了一个字段, 然后 T2 在该表中插入了一些新的行. 之后, 如果 T1 再次读取同一个表, 就会多出几行.（插入）</li>
</ul>
<p>数据库事务的隔离性: 数据库系统必须具有隔离并发运行各个事务的能力,使它们不会相互影响, 避免各种并发问题.</p>
<p><strong>一个事务与其他事务隔离的程度</strong>称为隔离级别. 数据库规定了多种事务隔离级别, 不同隔离级别对应不同的干扰程度, 隔离级别越高, 数据一致性就越好, 但并发性越弱.</p>
<p>mysql支持四种事务的隔离级别：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>隔离级别</th>
<th>描述</th>
<th>脏读</th>
<th>不可重复读</th>
<th>幻读</th>
</tr>
</thead>
<tbody>
<tr>
<td>READ UNCOMMITTED (读未提交数据)</td>
<td>允许事务读取未被其他事务提交的变更、脏读、不可重复读和幻读的问都户出现</td>
<td>有</td>
<td>有</td>
<td>有</td>
</tr>
<tr>
<td>READ COMMITTED(读已提交的数据)</td>
<td>只允许事务读取已经被其他事务提交的变更、可避免的脏读、但不可重复读和幻读的问题仍然可能出现</td>
<td>无</td>
<td>有</td>
<td>有</td>
</tr>
<tr>
<td>REPEATABLE READ(可重复读)</td>
<td>确保事务可以多次从一个字段中读取相同的值，在这个事务持续期间，禁止其他事务对这个字段更新，可以避免脏读和不可重复读，但幻读的问题仍然存在</td>
<td>无</td>
<td>无</td>
<td>有</td>
</tr>
<tr>
<td>SERIALIZABLE(串行化)</td>
<td>确保事务可以从一个表中读取相同的行，在这个事务持续期间，禁止其他事务对该表执行插入、更新和删除操作，所有并发问题都可以避免，但性能十分低下。</td>
<td>无</td>
<td>无</td>
<td>无</td>
</tr>
</tbody>
</table>
</div>
<p>Mysql默认的事务隔离级别为:REPEATABLE READ</p>
<h2 id="Mysql设置隔离级别"><a href="#Mysql设置隔离级别" class="headerlink" title="Mysql设置隔离级别"></a>Mysql设置隔离级别</h2><ul>
<li>每启动一个 mysql 程序, 就会获得一个单独的数据库连接. 每个数据库连接都有一个全局变量 @@tx_isolation, 表示当前的事务隔离级别.</li>
<li><p>查看当前的隔离级别: </p>
<p><code>SELECT @@tx_isolation;</code></p>
</li>
<li><p>设置当前 mySQL 连接的隔离级别:</p>
<p><code>set transaction isolation level read committed;</code></p>
</li>
<li><p>设置数据库系统的全局的隔离级别:</p>
<p><code>set global transaction isolation level read committed;</code></p>
</li>
</ul>
<h1 id="MySQL锁机制"><a href="#MySQL锁机制" class="headerlink" title="MySQL锁机制"></a>MySQL锁机制</h1><p>在数据库中，除传统的计算机资源(如CPU、RAM、I/O等)的争用以外，数据也是一中供许多用户分享的资源。如何保证数据并发访问的一致性、有效性是所有数据库必须解决的一个问题，锁冲突也是影像数据库并发访问性能的一个重要因素。从这个角度来说，锁对数据库而言显得更加重要，也更加复杂。</p>
<h2 id="Lock和Latch"><a href="#Lock和Latch" class="headerlink" title="Lock和Latch"></a>Lock和Latch</h2><p>Lock和Latch都可称为锁但是本身含义截然不同</p>
<div class="table-container">
<table>
<thead>
<tr>
<th></th>
<th>Lock</th>
<th>Latch</th>
</tr>
</thead>
<tbody>
<tr>
<td>对象</td>
<td>事务</td>
<td>线程</td>
</tr>
<tr>
<td>保护</td>
<td>数据库内容</td>
<td>内存数据结构</td>
</tr>
<tr>
<td>持续时间</td>
<td>整个事务过程</td>
<td>临界资源</td>
</tr>
<tr>
<td>模式</td>
<td>行锁，表锁，意向锁</td>
<td>对写锁，互斥量</td>
</tr>
<tr>
<td>死锁</td>
<td>通过waits-for graph、Time out等机制进行死锁检测与处理</td>
<td>无死锁检测与处理机制。仅通过应用程序加锁的顺序保证无死锁的情况发生。</td>
</tr>
<tr>
<td>存在于</td>
<td>Lock Manager 的哈希表中</td>
<td>每个数据结构的对象中</td>
</tr>
</tbody>
</table>
</div>
<p>使用<code>show engine innodb mutex;</code>命令可以查看latch信息</p>
<p>使用<code>show engine innodb status;</code>查看lock信息，也可以在information_schema下面的INNODB_TRX，INNODE_LOCKS，INNODB_LOCK_WAITS来观察锁的信息。</p>
<h2 id="锁的分类"><a href="#锁的分类" class="headerlink" title="锁的分类"></a>锁的分类</h2><ul>
<li>从对数据操作的类型(读/写)分：<ul>
<li>读锁(共享锁)：针对同一份数据，多个读操作可以同时进行而不会相互影响</li>
<li>写锁(排它锁)：当前写操作没有完成前，它会阻断其他写锁和读锁</li>
</ul>
</li>
<li>对数据操作的粒度分：<ul>
<li>表锁</li>
<li>页锁</li>
<li>行锁</li>
</ul>
</li>
</ul>
<h2 id="表锁"><a href="#表锁" class="headerlink" title="表锁"></a>表锁</h2><ul>
<li><p>特点：</p>
<p>偏向MyISAM 存储引擎，开销小，加锁快，无死锁；锁粒度大，发生所冲突的概率最高，并发度最低。</p>
<p>MyISAM在执行查询语句前，会自动给涉及的所有表加锁，在执行增删改操作前，会自动给涉及的表加写锁。</p>
</li>
<li><p>两种模式：</p>
<ul>
<li>表共享读锁(Table Read Lock)</li>
<li>表独占写锁(Table Write Lock)</li>
</ul>
</li>
</ul>
<div class="table-container">
<table>
<thead>
<tr>
<th>锁类型</th>
<th>兼容</th>
<th>读锁</th>
<th>写锁</th>
</tr>
</thead>
<tbody>
<tr>
<td>读锁</td>
<td>是</td>
<td>是</td>
<td>否</td>
</tr>
<tr>
<td>写锁</td>
<td>是</td>
<td>否</td>
<td>否</td>
</tr>
</tbody>
</table>
</div>
<p>总之就是读锁会阻塞写，但是不会阻塞读，而写锁则会把读和写都阻塞。</p>
<h2 id="页锁"><a href="#页锁" class="headerlink" title="页锁"></a>页锁</h2><p>开销和加锁时间界于表锁和行锁之间，会出现死锁；锁定粒度界于表锁和行锁之间，并发一般。</p>
<h2 id="行锁"><a href="#行锁" class="headerlink" title="行锁"></a>行锁</h2><ul>
<li><p>特点：</p>
<ul>
<li>偏向InnoDB存储引擎，开销大，加锁慢；会出现死锁；锁定粒度最小，发生锁冲突的概率最低，并发度也最高</li>
<li>InnoDB与MyISAM的最大不同有两点：一是支持事务(Transanction),二是采用了行级锁</li>
</ul>
</li>
<li><p>锁定一行：</p>
<p><code>select xxx...for update;</code></p>
</li>
</ul>
<p><em>varchar类型必须加单引号，否则会产生自动类型转换会使索引失效，<strong>行锁会转换成表锁</strong>，造成其他线程阻塞。</em></p>
<p>InnoDB存储引擎由于实现了行级锁定，虽然在锁定机制的实现方面所带来的性能损耗可能比标记锁定会要更高一些，但是在整体并发处理能力方面要远远优于MyISAM的表级锁定的。当系统并发量较高的时候,InnoDB的整体性能和MyISAM相比就会有比较明显的优势了。</p>
<p>但是InnoDB的行级锁定同样也有其脆弱的一面，当我们使用不当的时候，可能会让InnoDB的整体性能表现不仅不能比MyISAM高，甚至可能会更差。</p>
<h3 id="间隙锁"><a href="#间隙锁" class="headerlink" title="间隙锁"></a>间隙锁</h3><ul>
<li><p>定义：</p>
<p>当我们用范围条件而不是相等条件检索数据，并请求共享或排它锁时，InnoDB会给符合条件的已有数据记录的索引项加锁；对于键值在条件范围内但并不存在的记录，叫做”间隙（GAP）“，</p>
<p>InnoDB也会对这个”间隙“加锁，这种锁机制就是所谓的间隙锁(Next-Key锁) 。</p>
</li>
<li><p>危害</p>
<p>因为Query执行过程中通过范围查找的话，他会锁定整个范围内所有的索引键值，即使这个键值并不存在。</p>
<p>间隙锁有一个比较致命的弱点，就是当预定一个范围键值之后，即使某些不存在的键值也会被无辜锁定，而造成在锁定的时候无法插入锁定键值范围内的任何数据。在某些场景下可能对性能造成很大危害。(比如查询键值为2到5的数据时候，即使不存在键值为2的数据，在其他线程对2进行插入操作时该线程会被阻塞)</p>
</li>
</ul>
<h2 id="优化建议"><a href="#优化建议" class="headerlink" title="优化建议"></a>优化建议</h2><ul>
<li>尽可能让所有数据检索都通过索引来完成，避免无索引行锁升级为表锁</li>
<li>合理设计索引，尽量缩小锁的范围</li>
<li>尽可能较少检索条件，避免间隙锁</li>
<li>尽量控制事务的大小，减少锁定资源量和时间长度</li>
<li>尽可能低级别事务隔离</li>
</ul>
<h1 id="MySQL备份与恢复"><a href="#MySQL备份与恢复" class="headerlink" title="MySQL备份与恢复"></a>MySQL备份与恢复</h1><p>如果服务器宕机或者磁盘损坏数据库的内容就会丢失，这是非常严重的，因此需要平时备份数据库，以防意外情况出现。</p>
<h2 id="备份分类"><a href="#备份分类" class="headerlink" title="备份分类"></a>备份分类</h2><p>按照备份方法</p>
<ul>
<li>热备：运行时备份</li>
<li>冷备：停机备份，只需要复制物理文件即可</li>
<li>温备：加全局读锁保证备份数据一致性</li>
</ul>
<p>按照备份文件</p>
<ul>
<li>逻辑备份：文本文件，记录的是SQL语句，时间较长</li>
<li>裸文件备份：复制物理文件</li>
</ul>
<p>按照备份内容</p>
<ul>
<li>完全备份：整个数据库完整备份</li>
<li>增量备份：官方没有这种方法，需要借助二进制日志完成</li>
<li>日志备份：</li>
</ul>
<h2 id="逻辑备份与恢复"><a href="#逻辑备份与恢复" class="headerlink" title="逻辑备份与恢复"></a>逻辑备份与恢复</h2><p>基本备份格式 <code>mysqldump [arguments]  &gt;file_name</code></p>
<p>备份所有数据库 <code>mysqldump --all-databases  &gt;dump.sql</code></p>
<p>备份指定数据库 <code>mysqldump --databases db1 db2 db3 &gt;dump.sql</code></p>
<p>备份架构 <code>mysqldump --single-transaction db1 &gt;dump.sql</code></p>
<p>恢复 <code>mysql -uroot -p &lt;dump.sql</code></p>
<h2 id="二进制日志备份恢复"><a href="#二进制日志备份恢复" class="headerlink" title="二进制日志备份恢复"></a>二进制日志备份恢复</h2><p>备份 <code>flush logs</code>会生成新的二进制日志文件，然后备份之前的二进制日志</p>
<p>恢复<code>mysqlbinlog binlog.00001|mysql -uroot -p test</code></p>
<p>导入文件<code>mysqlbinlog binlog.00001&gt;logbin.sql</code></p>
<p><code>mysql -u root -p -e &quot;source logbin.sql &quot;</code></p>
<h1 id="MySQL主从复制"><a href="#MySQL主从复制" class="headerlink" title="MySQL主从复制"></a>MySQL主从复制</h1><ul>
<li><p>登录mysql数据库</p>
<p><code>mysql -u root -p</code></p>
</li>
<li><p>给服务器设置授权用户</p>
<p><code>GRANT ALL PRIVILEGES ON *.* TO &#39;user&#39; @ &#39;%&#39; IDENTIFIED BY &#39;password&#39; WITH GRANT OPTION;</code></p>
<p>%位置规定可以从哪个ip地址访问mysql数据库，%时为所有ip</p>
<p>​    with admin option 用于系统权限授权，with grant option 用于对象授权。</p>
<p>​    给一个用户授予系统权限带上with admin option 时，此用户可把此系统权限授予其他用户或角色，但收回这个用户的系统权限时，这个用户已经授予其他用户或角色的此系统权限不会因传播无效，如授予A系统权限create session with admin option,然后A又把create session权限授予B,但管理员收回A的create session权限时，B依然拥有create session的权限，但管理员可以显式收回B create session的权限，即直接revoke create session from B. </p>
<p>​    而with grant option用于对象授权时，被授予的用户也可把此对象权限授予其他用户或角色，不同的是但管理员收回用with grant option授权的用户对象权限时，权限会因传播而失效，如：grant select on 表名 to A with grant option;，A用户把此权限授予B，但管理员收回A的权限时，B的权限也会失效，但管理员不可以直接收回B的SELECT ON TABLE 权限。  执行授权语句报错（ora-01031，ora-01929）时，可参考一下。</p>
</li>
</ul>
<h4 id="Mysql主从复制"><a href="#Mysql主从复制" class="headerlink" title="Mysql主从复制"></a>Mysql主从复制</h4><ul>
<li><p>mysql复制的优点</p>
<ul>
<li>如果主服务器出现问题，可以快速切换到从服务器提供服务</li>
<li>可以在从服务器执行查询操作，降低主服务器的访问压力</li>
<li>可以在从服务器上执行备份，以避免备份期间影响主服务器的服务 </li>
</ul>
<p>注意：一般只有更新不频繁的数据或者对实时性要求不高的数据可以通过从服务器查询，实时性要求高的仍需从主数据库查询</p>
</li>
<li><p>主服务器配置</p>
<ul>
<li><p>给从服务器设置授权用户</p>
<p><code>GRANT ALL SLAVE ON *.* TO &#39;user&#39;@192.168.1.1 IDENTIFIED BY &#39;password&#39;</code>或者</p>
<p><code>GRANT ALL REPLICATION SLAVE ON *.* TO &#39;user&#39;@192.168.1.1 IDENTIFIED BY &#39;password&#39;</code></p>
</li>
<li><p>修改主服务器的配置文件my.cnf，开启binlog，并设置server-id的值</p>
<p>log-bin=mysql-bin</p>
<p>server-id=1</p>
</li>
<li><p>在主服务器设置读锁定有效，确保没有数据库操作，以便获得一个一致性的快照（选）</p>
<p><code>flush tables with read lock;</code></p>
</li>
<li><p>查看主服务器上当前的二进制日志名和偏移量值</p>
<p><code>show master status</code></p>
</li>
<li><p>目前主数据库服务器已经停止了更新操作，生成主数据库的备份，备份方式有两种：</p>
<p>cp全部的数据</p>
<p>mysqldump</p>
</li>
<li><p>主数据库备份完毕后，主数据库可以恢复写操作，剩下的操作只需在从服务器上去执行</p>
<p><code>unlock tables;</code></p>
</li>
<li><p>把主数据库的一致性备份复制到从数据库上，放到相应目录</p>
</li>
</ul>
</li>
<li><p>从服务器配置</p>
<ul>
<li><p>修改以下配置</p>
<p>server-id,不能与主数据库相同，必须唯一。</p>
<p>master-host=</p>
<p>master-user=</p>
<p>master-password=</p>
<p>master-port=</p>
<p>log-bin=mysql-bin</p>
</li>
<li><p>重启mysqld服务</p>
<p><code>service mysqld restart</code> 或者<code>pkill mysqld</code></p>
</li>
<li><p>查看主从复制进程列表</p>
<p><code>show processlist \G</code> 或者 <code>show slave status\G</code>   \G用于行列反转</p>
</li>
<li><p>从数据库常用命令</p>
<p>start slave 启动复制线程</p>
<p>stop slave 停止</p>
<p>show slave status 查看从数据库的状态</p>
<p>show master logs 查看主数据库bin-log日志</p>
<p>change master to 动态改变到主服务器的配置</p>
</li>
</ul>
</li>
</ul>

      
    </div>

    

    
    
    

    

    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div>如果对你有帮助，请赏包辣条</div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>打赏</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/images/wechatpay.jpg" alt="COKID 微信"/>
        <p>微信</p>
      </div>
    

    
      <div id="alipay" style="display: inline-block">
        <img id="alipay_qr" src="/images/alipay.jpg" alt="COKID 支付宝"/>
        <p>支付宝</p>
      </div>
    

    
      <div id="bitcoin" style="display: inline-block">
        <img id="bitcoin_qr" src="/images/bitcoin.jpg" alt="COKID 红包码"/>
        <p>红包码</p>
      </div>
    

  </div>
</div>

      </div>
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/MySQL/" rel="tag"># MySQL</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/01/10/java/线程与锁(以java语言为例)/" rel="next" title="线程与锁(以java语言为例)">
                <i class="fa fa-chevron-left"></i> 线程与锁(以java语言为例)
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/01/17/java/Kafka/" rel="prev" title="Kafka">
                Kafka <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  
    <div class="comments" id="comments">
    </div>
  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.jpg"
                alt="COKID" />
            
              <p class="site-author-name" itemprop="name">COKID</p>
              <p class="site-description motion-element" itemprop="description">Enjoy Code&Life</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">32</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">13</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">37</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  <a href="https://github.com/COKID" target="_blank" title="GitHub"><i class="fa fa-fw fa-github"></i>GitHub</a>
                  
                </span>
              
                <span class="links-of-author-item">
                  <a href="mailto:COKIDCC@outlook.com" target="_blank" title="E-Mail"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  
                </span>
              
            </div>
          

          
          

          
          

          
            
          
          
          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#MySQL引擎"><span class="nav-text">MySQL引擎</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#InnoDB引擎"><span class="nav-text">InnoDB引擎</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MyISAM引擎"><span class="nav-text">MyISAM引擎</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Memory"><span class="nav-text">Memory</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Archive"><span class="nav-text">Archive</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Federated"><span class="nav-text">Federated</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#MySQL文件"><span class="nav-text">MySQL文件</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#参数文件"><span class="nav-text">参数文件</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#查看"><span class="nav-text">查看</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#修改"><span class="nav-text">修改</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#日志文件"><span class="nav-text">日志文件</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#二进制日志"><span class="nav-text">二进制日志</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#套接字文件"><span class="nav-text">套接字文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#PID文件"><span class="nav-text">PID文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#frm文件"><span class="nav-text">frm文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#表空间文件（InnoDB）"><span class="nav-text">表空间文件（InnoDB）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#重做日志文件（InnoDB）"><span class="nav-text">重做日志文件（InnoDB）</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#MySQL索引"><span class="nav-text">MySQL索引</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#定义："><span class="nav-text">定义：</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MySQL索引结构（InnoDB）"><span class="nav-text">MySQL索引结构（InnoDB）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#聚集索引"><span class="nav-text">聚集索引</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#辅助索引"><span class="nav-text">辅助索引</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#优点："><span class="nav-text">优点：</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#缺点："><span class="nav-text">缺点：</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MySQL索引分类"><span class="nav-text">MySQL索引分类</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MySQL索引语法"><span class="nav-text">MySQL索引语法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#什么时候建立索引"><span class="nav-text">什么时候建立索引</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#什么时候不要索引"><span class="nav-text">什么时候不要索引</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#MySQL事务"><span class="nav-text">MySQL事务</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#事务的概念"><span class="nav-text">事务的概念</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Mysql使用事务"><span class="nav-text">Mysql使用事务</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#事务的并发"><span class="nav-text">事务的并发</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Mysql设置隔离级别"><span class="nav-text">Mysql设置隔离级别</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#MySQL锁机制"><span class="nav-text">MySQL锁机制</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Lock和Latch"><span class="nav-text">Lock和Latch</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#锁的分类"><span class="nav-text">锁的分类</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#表锁"><span class="nav-text">表锁</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#页锁"><span class="nav-text">页锁</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#行锁"><span class="nav-text">行锁</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#间隙锁"><span class="nav-text">间隙锁</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#优化建议"><span class="nav-text">优化建议</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#MySQL备份与恢复"><span class="nav-text">MySQL备份与恢复</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#备份分类"><span class="nav-text">备份分类</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#逻辑备份与恢复"><span class="nav-text">逻辑备份与恢复</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#二进制日志备份恢复"><span class="nav-text">二进制日志备份恢复</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#MySQL主从复制"><span class="nav-text">MySQL主从复制</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Mysql主从复制"><span class="nav-text">Mysql主从复制</span></a></li></ol></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      
        <div class="back-to-top">
          <i class="fa fa-arrow-up"></i>
          
            <span id="scrollpercent"><span>0</span>%</span>
          
        </div>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">COKID</span>

  

  
</div>














<div>
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次</span>
<span id="busuanzi_container_site_uv" style='display:none'>有<span id="busuanzi_value_site_uv"></span>人看过我的博客啦
</span>
<div>



        








        
      </div>
    </footer>

    

    
      <div id="needsharebutton-float">
        <span class="btn">
          <i class="fa fa-share-alt" aria-hidden="true"></i>
        </span>
      </div>
    
	
    

    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


















  
  









  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/three/three.min.js"></script>
  

  
  
    <script type="text/javascript" src="/lib/three/canvas_lines.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.4.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.4.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=6.4.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=6.4.0"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=6.4.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=6.4.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.4.0"></script>



  



  








  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  
  
  <script src="//unpkg.com/valine/dist/Valine.min.js"></script>
  
  <script type="text/javascript">
    var GUEST = ['nick','mail','link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(function (item) {
      return GUEST.indexOf(item)>-1;
    });
    new Valine({
        el: '#comments' ,
        verify: false,
        notify: true,
        appId: 'oGsBWh72tqHrNVGmA9kSkN9O-gzGzoHsz',
        appKey: 'ngWmBvpNuti55zjUcUzDFDfM',
        placeholder: '欢迎指正',
        avatar:'mm',
        meta:guest,
        pageSize:'10' || 10,
        visitor: false
    });
  </script>



  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  
  <script>
    
    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();

      Counter('get', '/classes/Counter', { where: JSON.stringify({ url }) })
        .done(function ({ results }) {
          if (results.length > 0) {
            var counter = results[0];
            
            Counter('put', `/classes/Counter/${counter.objectId}`, JSON.stringify({ time: { "__op":"Increment", "amount":1 } }))
            
            .done(function () {
                  var $element = $(document.getElementById(url));
                  $element.find('.leancloud-visitors-count').text(counter.time + 1);
            })
            
            .fail(function ({ responseJSON }) {
                console.log('Failed to save Visitor num, with error message: ' + responseJSON.error);
            })
          } else {
            
              Counter('post', '/classes/Counter', JSON.stringify({ title: title, url: url, time: 1}))
                .done(function () {
                  var $element = $(document.getElementById(url));
                  $element.find('.leancloud-visitors-count').text(1);
                })
                .fail(function () {
                  console.log('Failed to create');
                });
            
          }
        })
      .fail(function ({ responseJSON }) {
        console.log('LeanCloud Counter Error:' + responseJSON.code + " " + responseJSON.error);
      });
    }
    

    $(function() {
      $.get('https://app-router.leancloud.cn/2/route?appId=' + "oGsBWh72tqHrNVGmA9kSkN9O-gzGzoHsz")
        .done(function ({ api_server }) {
          var Counter = function (method, url, data) {
            return $.ajax({
              method: method,
              url: `https://${api_server}/1.1${url}`,
              headers: {
                'X-LC-Id': "oGsBWh72tqHrNVGmA9kSkN9O-gzGzoHsz",
                'X-LC-Key': "ngWmBvpNuti55zjUcUzDFDfM",
                'Content-Type': 'application/json',
              },
              data: data,
            });
          };
          
          addCount(Counter);
          
        })
    });
  </script>



  

  

  
  

  
  

  
    
      <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      },
      TeX: {equationNumbers: { autoNumber: "AMS" }}
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
      var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>
<script type="text/javascript" src="//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

    
  


  
  
  
  <script src="/lib/needsharebutton/needsharebutton.js"></script>

  <script>
    
    
      flOptions = {};
      
          flOptions.iconStyle = "default";
      
          flOptions.boxForm = "vertical";
      
          flOptions.position = "middleRight";
      
          flOptions.networks = "Weibo,Wechat,QQZone,Twitter,Facebook";
      
      new needShareButton('#needsharebutton-float', flOptions);
    
  </script>

  

  

  

  

  

  
  <style>
    .copy-btn {
      display: inline-block;
      padding: 6px 12px;
      font-size: 13px;
      font-weight: 700;
      line-height: 20px;
      color: #333;
      white-space: nowrap;
      vertical-align: middle;
      cursor: pointer;
      background-color: #eee;
      background-image: linear-gradient(#fcfcfc, #eee);
      border: 1px solid #d5d5d5;
      border-radius: 3px;
      user-select: none;
      outline: 0;
    }

    .highlight-wrap .copy-btn {
      transition: opacity .3s ease-in-out;
      opacity: 0;
      padding: 2px 6px;
      position: absolute;
      right: 4px;
      top: 8px;
    }

    .highlight-wrap:hover .copy-btn,
    .highlight-wrap .copy-btn:focus {
      opacity: 1
    }

    .highlight-wrap {
      position: relative;
    }
  </style>
  <script>
    $('.highlight').each(function (i, e) {
      var $wrap = $('<div>').addClass('highlight-wrap')
      $(e).after($wrap)
      $wrap.append($('<button>').addClass('copy-btn').append('复制').on('click', function (e) {
        var code = $(this).parent().find('.code').find('.line').map(function (i, e) {
          return $(e).text()
        }).toArray().join('\n')
        var ta = document.createElement('textarea')
        document.body.appendChild(ta)
        ta.style.position = 'absolute'
        ta.style.top = '0px'
        ta.style.left = '0px'
        ta.value = code
        ta.select()
        ta.focus()
        var result = document.execCommand('copy')
        document.body.removeChild(ta)
        
          if(result)$(this).text('复制成功')
          else $(this).text('复制失败')
        
        $(this).blur()
      })).on('mouseleave', function (e) {
        var $b = $(this).find('.copy-btn')
        setTimeout(function () {
          $b.text('复制')
        }, 300)
      }).append(e)
    })
  </script>


</body>
</html>
